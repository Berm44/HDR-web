<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HDR Admin Pro - ‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏Å‡∏¥‡∏ï‡∏ï‡πå (Enhanced)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

  <style>
    :root {
      --sidebar-width: 280px;
      --bg-body: #0a0f1e;
      --bg-card: #161e31;
      --bg-input: #1e293b;
      --border-color: rgba(139, 92, 246, 0.2);
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --primary: #a78bfa;
      --primary-dark: #7c3aed;
      --accent: #c084fc;
      --accent-bright: #e879f9;
      --success: #34d399;
      --danger: #fb7185;
      --warning: #fbbf24;
      --radius-lg: 16px;
      --radius-sm: 8px;
      --glow-purple: 0 0 20px rgba(167, 139, 250, 0.4), 0 0 40px rgba(167, 139, 250, 0.2);
      --glow-accent: 0 0 20px rgba(232, 121, 249, 0.4), 0 0 40px rgba(232, 121, 249, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Kanit', sans-serif;
      background: linear-gradient(135deg, #0a0f1e 0%, #1a0b2e 50%, #0a0f1e 100%);
      color: var(--text-main);
      display: flex;
      min-height: 100vh;
      letter-spacing: 0.3px;
      overflow-x: hidden;
      position: relative;
    }

    /* Animated Background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 50%, rgba(167, 139, 250, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(232, 121, 249, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(124, 58, 237, 0.08) 0%, transparent 50%);
      animation: backgroundPulse 15s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes backgroundPulse {

      0%,
      100% {
        opacity: 0.5;
        transform: scale(1);
      }

      50% {
        opacity: 0.8;
        transform: scale(1.1);
      }
    }

    /* Floating Particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--primary);
      border-radius: 50%;
      box-shadow: var(--glow-purple);
      animation: float 20s infinite;
      opacity: 0.6;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0) translateX(0);
        opacity: 0;
      }

      10% {
        opacity: 0.6;
      }

      90% {
        opacity: 0.6;
      }

      100% {
        transform: translateY(-100vh) translateX(100px);
        opacity: 0;
      }
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(180deg, rgba(22, 30, 49, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      z-index: 100;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 4px 0 30px rgba(167, 139, 250, 0.1);
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(180deg, rgba(167, 139, 250, 0.05) 0%, transparent 100%);
      pointer-events: none;
    }

    .sidebar-header {
      padding: 2.5rem 2rem;
      font-size: 1.6rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-bright) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      animation: slideInLeft 0.6s ease;
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .sidebar-header i {
      font-size: 2.4rem;
      filter: drop-shadow(0 0 15px rgba(167, 139, 250, 0.8));
      animation: iconGlow 3s ease-in-out infinite;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-bright) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    @keyframes iconGlow {

      0%,
      100% {
        filter: drop-shadow(0 0 15px rgba(167, 139, 250, 0.6));
      }

      50% {
        filter: drop-shadow(0 0 25px rgba(232, 121, 249, 0.8));
      }
    }

    .nav-menu {
      flex: 1;
      padding: 0.5rem 1.2rem;
      animation: fadeInUp 0.8s ease 0.2s both;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .nav-item {
      padding: 14px 18px;
      border-radius: var(--radius-sm);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 8px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--primary), var(--accent-bright));
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .nav-item:hover {
      background: rgba(167, 139, 250, 0.1);
      color: var(--text-main);
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(167, 139, 250, 0.2);
    }

    .nav-item:hover::before {
      transform: scaleY(1);
    }

    .nav-item.active {
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(232, 121, 249, 0.2));
      color: white;
      box-shadow: 0 8px 20px rgba(167, 139, 250, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(167, 139, 250, 0.3);
      transform: translateX(5px);
    }

    .nav-item.active::before {
      transform: scaleY(1);
      box-shadow: var(--glow-purple);
    }

    .nav-item i {
      font-size: 1.3rem;
      transition: transform 0.3s ease;
    }

    .nav-item:hover i,
    .nav-item.active i {
      transform: scale(1.1) rotate(5deg);
    }

    .sidebar-footer {
      padding: 1.5rem;
      border-top: 1px solid var(--border-color);
      background: rgba(167, 139, 250, 0.05);
      animation: fadeInUp 1s ease 0.4s both;
    }

    #displayName {
      font-weight: 500;
      color: var(--text-main);
      font-size: 0.95rem;
    }

    /* Top Bar Buttons - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô */
    .top-bar-buttons {
      position: fixed;
      top: 20px;
      left: 300px;
      z-index: 150;
      display: flex;
      gap: 10px;
      transition: left 0.3s ease;
      animation: slideInDown 0.6s ease;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å */
    .login-back-button {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1001;
      /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ login panel */
      animation: slideInDown 0.6s ease;
    }

    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .btn-home {
      background: rgba(167, 139, 250, 0.15);
      border: 1px solid rgba(167, 139, 250, 0.4);
      color: var(--primary);
      padding: 10px 20px;
      border-radius: 50px;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(10px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(167, 139, 250, 0.2);
    }

    .btn-home:hover {
      background: rgba(167, 139, 250, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(167, 139, 250, 0.4);
    }

    .btn-home i {
      transition: transform 0.3s ease;
    }

    .btn-home:hover i {
      transform: translateX(-3px);
    }

    /* Main Content */
    .main-content {
      margin-left: var(--sidebar-width);
      flex: 1;
      padding: 3rem;
      transition: margin 0.3s ease;
      width: 100%;
      position: relative;
      z-index: 2;
    }

    .page-section {
      display: none;
    }

    .page-section.active {
      display: block;
      animation: pageSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes pageSlideIn {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.98);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .section-header {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2.5rem;
      animation: fadeInUp 0.6s ease;
    }

    h2 {
      font-weight: 600;
      margin: 0;
      font-size: 2rem;
      display: flex;
      align-items: center;
      gap: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-bright) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(167, 139, 250, 0.3);
    }

    h2 i {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-bright) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 10px rgba(167, 139, 250, 0.5));
    }

    /* Stats Cards */
    .reads-stats {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      animation: scaleIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .read-card {
      flex: 1;
      text-align: center;
      padding: 25px;
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(232, 121, 249, 0.1));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(167, 139, 250, 0.3);
      backdrop-filter: blur(10px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .read-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(167, 139, 250, 0.1), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }

      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    .read-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 40px rgba(167, 139, 250, 0.3), var(--glow-purple);
      border-color: var(--primary);
    }

    .read-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      z-index: 1;
    }

    .read-value {
      font-size: 3rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-bright) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1.2;
      position: relative;
      z-index: 1;
      animation: numberPulse 2s ease-in-out infinite;
    }

    @keyframes numberPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    .read-warning {
      font-size: 0.95rem;
      color: var(--warning);
      margin-top: 15px;
      padding: 10px;
      background: rgba(251, 191, 36, 0.1);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(251, 191, 36, 0.3);
      animation: warningPulse 2s infinite;
    }

    @keyframes warningPulse {

      0%,
      100% {
        opacity: 1;
        box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
      }

      50% {
        opacity: 0.7;
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
      }
    }

    /* Date Selector */
    .date-selector {
      background: linear-gradient(135deg, rgba(22, 30, 49, 0.8), rgba(15, 23, 42, 0.9));
      backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: scaleIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
      position: relative;
      overflow: hidden;
    }

    .date-selector::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.05), rgba(232, 121, 249, 0.05));
      pointer-events: none;
    }

    .date-input-group {
      flex: 2;
      min-width: 250px;
      position: relative;
      z-index: 1;
    }

    .date-label {
      display: block;
      margin-bottom: 10px;
      color: var(--text-muted);
      font-size: 0.95rem;
      font-weight: 500;
    }

    .date-input {
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid rgba(167, 139, 250, 0.3);
      border-radius: var(--radius-sm);
      padding: 14px 18px;
      color: white;
      font-family: 'Kanit';
      width: 100%;
      font-size: 1rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .date-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.2), var(--glow-purple);
      transform: translateY(-2px);
    }

    .btn-summary {
      flex: 1;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-bright) 100%);
      color: white;
      padding: 16px 32px;
      border-radius: 60px;
      font-size: 1.3rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      box-shadow: 0 10px 30px rgba(167, 139, 250, 0.4), var(--glow-purple);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 220px;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .btn-summary::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-summary:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-summary:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 20px 50px rgba(167, 139, 250, 0.6), var(--glow-accent);
    }

    .btn-summary:active {
      transform: translateY(-2px) scale(1.02);
    }

    .btn-summary i {
      font-size: 1.4rem;
      position: relative;
      z-index: 2;
    }

    .btn-summary span {
      position: relative;
      z-index: 2;
    }

    .btn-summary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Summary Content */
    .summary-content {
      display: none;
    }

    .summary-content.show {
      display: block;
      animation: contentReveal 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes contentReveal {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card {
      background: linear-gradient(135deg, rgba(22, 30, 49, 0.8), rgba(15, 23, 42, 0.9));
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.03), rgba(232, 121, 249, 0.03));
      pointer-events: none;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 70px rgba(167, 139, 250, 0.2);
      border-color: rgba(167, 139, 250, 0.4);
    }

    /* Room Stats Grid */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 20px;
      margin-bottom: 2.5rem;
    }

    .room-card {
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(232, 121, 249, 0.1));
      border: 1px solid rgba(167, 139, 250, 0.3);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
      text-align: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      animation: cardPopIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) backwards;
    }

    .room-card:nth-child(1) {
      animation-delay: 0.1s;
    }

    .room-card:nth-child(2) {
      animation-delay: 0.15s;
    }

    .room-card:nth-child(3) {
      animation-delay: 0.2s;
    }

    .room-card:nth-child(4) {
      animation-delay: 0.25s;
    }

    .room-card:nth-child(5) {
      animation-delay: 0.3s;
    }

    .room-card:nth-child(6) {
      animation-delay: 0.35s;
    }

    .room-card:nth-child(7) {
      animation-delay: 0.4s;
    }

    @keyframes cardPopIn {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(20px);
      }

      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .room-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
      transform: rotate(45deg);
      transition: all 0.5s;
    }

    .room-card:hover::before {
      left: 100%;
    }

    .room-card:hover {
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 15px 40px rgba(167, 139, 250, 0.4), var(--glow-purple);
      border-color: var(--primary);
    }

    .room-card h4 {
      margin: 0 0 10px 0;
      color: var(--text-muted);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }

    .room-card .val {
      font-size: 2rem;
      font-weight: 700;
      margin: 12px 0;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-bright) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: valueGlow 2s ease-in-out infinite;
    }

    @keyframes valueGlow {

      0%,
      100% {
        filter: drop-shadow(0 0 5px rgba(167, 139, 250, 0.5));
      }

      50% {
        filter: drop-shadow(0 0 15px rgba(232, 121, 249, 0.8));
      }
    }

    .room-card .absent-text {
      font-size: 0.85rem;
      color: var(--danger);
      font-weight: 500;
      padding: 4px 8px;
      background: rgba(251, 113, 133, 0.1);
      border-radius: 20px;
      display: inline-block;
    }

    /* Tables */
    .table-container {
      border-radius: var(--radius-lg);
      overflow-x: auto;
      border: 1px solid var(--border-color);
      background: rgba(0, 0, 0, 0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    th {
      padding: 18px 20px;
      text-align: left;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--primary);
      text-transform: uppercase;
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(232, 121, 249, 0.15));
      letter-spacing: 1px;
    }

    td {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(167, 139, 250, 0.1);
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tbody tr {
      transition: all 0.3s ease;
    }

    tbody tr:hover {
      background: rgba(167, 139, 250, 0.08);
      transform: scale(1.01);
    }

    /* Loading Spinner */
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 60px;
      color: var(--primary);
      font-size: 1.1rem;
    }

    .loading-spinner i {
      font-size: 2.5rem;
      margin-right: 15px;
      animation: spin 1s linear infinite;
      filter: drop-shadow(0 0 10px rgba(167, 139, 250, 0.6));
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Form Elements */
    input,
    select {
      background: rgba(30, 41, 59, 0.8);
      color: white;
      border: 1px solid rgba(167, 139, 250, 0.3);
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      font-family: 'Kanit';
      font-size: 0.95rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      width: 100%;
    }

    input:focus,
    select:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.2), var(--glow-purple);
      transform: translateY(-2px);
    }

    /* Buttons */
    button {
      padding: 12px 24px;
      border-radius: var(--radius-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'Kanit';
      border: none;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--accent-bright));
      color: white;
      box-shadow: 0 4px 15px rgba(167, 139, 250, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(167, 139, 250, 0.5), var(--glow-purple);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #10b981);
      color: white;
      box-shadow: 0 4px 15px rgba(52, 211, 153, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(52, 211, 153, 0.5);
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning), #f59e0b);
      color: #78350f;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }

    .btn-warning:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(251, 191, 36, 0.5);
    }

    .btn-danger-light {
      background: rgba(251, 113, 133, 0.15);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    .btn-danger-light:hover {
      background: rgba(251, 113, 133, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(251, 113, 133, 0.4);
    }

    .btn-icon-round {
      width: 38px;
      height: 38px;
      padding: 0;
      justify-content: center;
      border-radius: 50%;
      font-size: 1.1rem;
    }

    .btn-icon-round:hover {
      transform: rotate(15deg) scale(1.1);
    }

    /* Badges */
    .badge-absent {
      background: rgba(251, 113, 133, 0.15);
      color: var(--danger);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid rgba(251, 113, 133, 0.3);
      animation: badgePulse 2s ease-in-out infinite;
    }

    @keyframes badgePulse {

      0%,
      100% {
        box-shadow: 0 0 5px rgba(251, 113, 133, 0.3);
      }

      50% {
        box-shadow: 0 0 15px rgba(251, 113, 133, 0.6);
      }
    }

    .badge-present {
      background: rgba(52, 211, 153, 0.15);
      color: var(--success);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid rgba(52, 211, 153, 0.3);
    }

    /* Login Panel */
    #loginPanel {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0a0f1e 0%, #1a0b2e 50%, #0a0f1e 100%);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    #loginPanel .card {
      animation: loginCardAppear 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(167, 139, 250, 0.3);
      box-shadow: 0 30px 80px rgba(167, 139, 250, 0.3), var(--glow-purple);
    }

    @keyframes loginCardAppear {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(30px);
      }

      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    #loginPanel .card>div:first-child {
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(232, 121, 249, 0.2));
      animation: iconRotate 3s ease-in-out infinite;
    }

    @keyframes iconRotate {

      0%,
      100% {
        transform: rotate(0deg);
      }

      50% {
        transform: rotate(5deg);
      }
    }

    #loadingOverlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 15, 30, 0.95);
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      backdrop-filter: blur(10px);
    }

    #loadingOverlay>div {
      border: 4px solid rgba(167, 139, 250, 0.2);
      border-top: 4px solid var(--primary);
      box-shadow: var(--glow-purple);
    }

    /* Mobile Menu Button */
    #mobileMenuBtn {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 150;
      box-shadow: 0 4px 20px rgba(167, 139, 250, 0.4), var(--glow-purple);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .sidebar {
        transform: translateX(-100%);
        width: 260px;
        box-shadow: 10px 0 50px rgba(167, 139, 250, 0.3);
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
        padding: 5rem 1.5rem 2rem;
      }

      #mobileMenuBtn {
        display: flex;
      }

      .summary-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .top-bar-buttons {
        left: 80px;
      }

      .reads-stats {
        flex-direction: column;
        gap: 10px;
      }

      .date-selector {
        flex-direction: column;
      }

      .btn-summary {
        width: 100%;
      }

      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      .login-back-button {
        top: 10px;
        right: 10px;
      }

      .login-back-button .btn-home {
        padding: 8px 16px;
        font-size: 0.9rem;
      }
    }

    @media (max-width: 480px) {
      .summary-grid {
        grid-template-columns: 1fr;
      }

      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .section-header button {
        width: 100%;
        justify-content: center;
      }

      .top-bar-buttons {
        left: 70px;
      }

      .btn-home {
        padding: 8px 12px;
        font-size: 0.85rem;
      }

      h2 {
        font-size: 1.5rem;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(10, 15, 30, 0.5);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--primary), var(--accent-bright));
      border-radius: 10px;
      box-shadow: var(--glow-purple);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, var(--accent-bright), var(--primary));
    }

    /* ‚ïê‚ïê‚ïê FLOATING ORBS ‚ïê‚ïê‚ïê */
    .bg-orbs {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .bg-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(90px);
      opacity: 0.2;
      animation: orbFloat 20s ease-in-out infinite alternate;
    }

    .bg-orb:nth-child(1) {
      width: 500px;
      height: 500px;
      top: -12%;
      left: -5%;
      background: rgba(167, 139, 250, 0.3);
      animation-duration: 18s;
    }

    .bg-orb:nth-child(2) {
      width: 400px;
      height: 400px;
      bottom: -10%;
      right: -8%;
      background: rgba(192, 132, 252, 0.25);
      animation-duration: 24s;
      animation-delay: -5s;
    }

    .bg-orb:nth-child(3) {
      width: 300px;
      height: 300px;
      top: 40%;
      left: 50%;
      background: rgba(34, 211, 238, 0.1);
      animation-duration: 28s;
      animation-delay: -10s;
    }

    @keyframes orbFloat {
      0% {
        transform: translate(0, 0) scale(1);
      }

      33% {
        transform: translate(30px, -50px) scale(1.1);
      }

      66% {
        transform: translate(-25px, 35px) scale(0.95);
      }

      100% {
        transform: translate(20px, -20px) scale(1.05);
      }
    }

    .bg-noise {
      position: fixed;
      inset: 0;
      z-index: 0;
      opacity: 0.02;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
      background-repeat: repeat;
      background-size: 256px;
    }

    /* ‚ïê‚ïê‚ïê ROOM CARD SHIMMER ‚ïê‚ïê‚ïê */
    .room-card {
      position: relative;
      overflow: hidden;
    }

    .room-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 60%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.04), transparent);
      transition: left 0.6s ease;
      pointer-events: none;
    }

    .room-card:hover::before {
      left: 150%;
    }

    /* ‚ïê‚ïê‚ïê CUSTOM SCROLLBAR ‚ïê‚ïê‚ïê */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.15);
    }
  </style>
</head>

<body>
  <!-- Floating Particles -->
  <div class="particles">
    <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
    <div class="particle" style="left: 30%; animation-delay: 4s;"></div>
    <div class="particle" style="left: 40%; animation-delay: 1s;"></div>
    <div class="particle" style="left: 50%; animation-delay: 3s;"></div>
    <div class="particle" style="left: 60%; animation-delay: 5s;"></div>
    <div class="particle" style="left: 70%; animation-delay: 2.5s;"></div>
    <div class="particle" style="left: 80%; animation-delay: 4.5s;"></div>
    <div class="particle" style="left: 90%; animation-delay: 1.5s;"></div>
  </div>

  <!-- Floating Orbs -->
  <div class="bg-orbs">
    <div class="bg-orb"></div>
    <div class="bg-orb"></div>
    <div class="bg-orb"></div>
  </div>
  <div class="bg-noise"></div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô) -->
  <div class="login-back-button" id="loginBackButton">
    <button class="btn-home" onclick="goToMainMenu()">
      <i class="ri-home-line"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
    </button>
  </div>

  <div class="top-bar-buttons" id="loggedInBackButton" style="display: none;">
    <button class="btn-home" onclick="goToMainMenu()">
      <i class="ri-home-line"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
    </button>
  </div>

  <button id="mobileMenuBtn" class="btn-primary btn-icon-round" onclick="toggleSidebar()">
    <i class="ri-menu-line"></i>
  </button>

  <div id="loadingOverlay">
    <div
      style="border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;">
    </div>
    <p style="margin-top: 15px; color: var(--primary);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
  </div>

  <div id="loginPanel">
    <div class="card" style="width: 100%; max-width: 400px; text-align: center;">
      <div
        style="background: rgba(167,139,250,0.15); width: 90px; height: 90px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 25px; border: 2px solid rgba(167, 139, 250, 0.3); box-shadow: var(--glow-purple);">
        <i class="ri-shield-keyhole-line"
          style="font-size: 3.5rem; color: var(--primary); filter: drop-shadow(0 0 10px rgba(167, 139, 250, 0.6));"></i>
      </div>

      <h2 style="justify-content: center; margin-bottom: 10px;">ADMIN ACCESS</h2>
      <p style="color:var(--text-muted); margin-bottom: 30px; font-size: 0.95rem;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (HDR)
      </p>

      <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" style="margin-bottom:15px;">
      <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" style="margin-bottom:30px;">

      <button class="btn-primary" onclick="handleLogin()"
        style="width:100%; justify-content:center; padding: 16px; font-size: 1.1rem;">
        <i class="ri-login-circle-line"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
      </button>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-header">
      <i class="ri-shield-check-fill"></i> HDR PRO
    </div>
    <nav class="nav-menu">
      <div class="nav-item active" onclick="switchTab('dashboard', this)">
        <i class="ri-dashboard-3-line"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
      </div>
      <div class="nav-item" onclick="switchTab('manage', this)">
        <i class="ri-user-settings-line"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
      </div>
      <div class="nav-item" onclick="switchTab('import', this)">
        <i class="ri-folder-upload-line"></i> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV
      </div>
    </nav>
    <div class="sidebar-footer">
      <div style="display:flex; align-items:center; gap:12px; margin-bottom:18px;">
        <img
          src="https://media.discordapp.net/attachments/1282030855119966349/1471830866945638430/IMG_8813.png?ex=69905ccf&is=698f0b4f&hm=ca7144419ee277200fdac36b937f86b069b375b33a510f0f64d1ea41c516b08f&=&format=webp&quality=lossless&width=649&height=648"
          style="width:40px; height:40px; border-radius:50%; object-fit:cover; border: 2px solid var(--primary); box-shadow: var(--glow-purple);">
        <span id="displayName">Loading...</span>
      </div>
      <button class="btn-danger-light" onclick="handleLogout()"
        style="width:100%; justify-content:center; font-size: 0.9rem;">
        <i class="ri-logout-circle-r-line"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
      </button>
    </div>
  </aside>

  <main class="main-content">

    <section id="dashboard" class="page-section active">
      <div class="section-header">
        <h2><i class="ri-bar-chart-2-fill"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
        <button class="btn-success" onclick="exportAbsentList()">
          <i class="ri-file-download-line"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏î
        </button>
      </div>

      <div class="reads-stats">
        <div class="read-card">
          <div class="read-label">üìä Reads (today)</div>
          <div class="read-value" id="readsToday">0</div>
        </div>
        <div class="read-card">
          <div class="read-label">üöÄ Reads (peak)</div>
          <div class="read-value" id="readsPeak">0</div>
        </div>
      </div>

      <div class="read-warning" id="readWarning" style="display: none;">
        <i class="ri-alert-line"></i> ‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á 50,000 reads ‡πÅ‡∏•‡πâ‡∏ß!
      </div>

      <div class="date-selector">
        <div class="date-input-group">
          <label class="date-label">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
          <input type="date" id="reportDate" class="date-input" value="">
        </div>
        <button class="btn-summary" onclick="generateSummary()" id="summaryButton">
          <i class="ri-file-list-line"></i>
          <span>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</span>
          <i class="ri-arrow-right-line"></i>
        </button>
      </div>

      <div class="summary-content" id="summaryContent">
        <div class="card">
          <div class="summary-grid" id="roomStatsGrid"></div>

          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                  <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
                  <th>‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß</th>
                  <th>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏≤</th>
                </tr>
              </thead>
              <tbody id="summaryList"></tbody>
            </table>
          </div>
        </div>

        <h3
          style="color:var(--danger); display:flex; align-items:center; gap:10px; margin-top:3rem; animation: fadeInUp 0.6s ease;">
          <i class="ri-user-unfollow-line"></i> ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ (‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
        </h3>
        <div class="card" style="padding: 1rem;">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</th>
                  <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                  <th>‡∏´‡πâ‡∏≠‡∏á</th>
                  <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
              </thead>
              <tbody id="absentDetailList"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section id="manage" class="page-section">
      <div class="section-header">
        <h2><i class="ri-group-fill"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
        <button class="btn-primary" onclick="startEdit('', '', '6/1')">
          <i class="ri-user-add-line"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà
        </button>
      </div>

      <div class="card" id="editForm"
        style="border-left: 5px solid var(--warning); display:none; background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(251, 191, 36, 0.05));">
        <h3 style="margin-top:0"><i class="ri-edit-box-line"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
        <input type="hidden" id="editOldId">
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px;">
          <div>
            <label
              style="display:block; margin-bottom:8px; font-size:0.85rem; color: var(--text-muted);">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
            <input type="number" id="editId">
          </div>
          <div>
            <label
              style="display:block; margin-bottom:8px; font-size:0.85rem; color: var(--text-muted);">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input type="text" id="editName">
          </div>
          <div>
            <label style="display:block; margin-bottom:8px; font-size:0.85rem; color: var(--text-muted);">‡∏´‡πâ‡∏≠‡∏á</label>
            <select id="editClass">
              <option value="6/1">6/1</option>
              <option value="6/2">6/2</option>
              <option value="6/3">6/3</option>
              <option value="6/4">6/4</option>
              <option value="6/5">6/5</option>
              <option value="6/6">6/6</option>
              <option value="6/7">6/7</option>
            </select>
          </div>
        </div>
        <div style="margin-top:25px; display:flex; gap:12px;">
          <button class="btn-primary" onclick="updateStudent()">
            <i class="ri-save-line"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          </button>
          <button class="btn-danger-light" onclick="cancelEdit()" style="border:none">
            <i class="ri-close-line"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
        </div>
      </div>

      <div class="card">
        <div style="display:grid; grid-template-columns: 3fr 1fr; gap:15px; margin-bottom:1.5rem;">
          <div style="position:relative;">
            <i class="ri-search-line"
              style="position:absolute; left:15px; top:50%; transform:translateY(-50%); color:var(--text-muted); z-index: 10;"></i>
            <input type="text" id="searchBox" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." oninput="renderStudentTable()"
              style="padding-left:45px;">
          </div>
          <select id="filterClass" onchange="renderStudentTable()">
            <option value="all">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
            <option value="6/1">‡∏°.6/1</option>
            <option value="6/2">‡∏°.6/2</option>
            <option value="6/3">‡∏°.6/3</option>
            <option value="6/4">‡∏°.6/4</option>
            <option value="6/5">‡∏°.6/5</option>
            <option value="6/6">‡∏°.6/6</option>
            <option value="6/7">‡∏°.6/7</option>
          </select>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>‡∏£‡∏´‡∏±‡∏™</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                <th>‡∏´‡πâ‡∏≠‡∏á</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="studentTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="import" class="page-section">
      <div class="section-header">
        <h2><i class="ri-database-fill"></i> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
      </div>
      <div class="card" style="text-align:center; padding: 4rem 2rem;">
        <i class="ri-file-excel-2-line"
          style="font-size: 6rem; background: linear-gradient(135deg, var(--primary), var(--accent-bright)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; opacity: 0.4; animation: iconGlow 3s ease-in-out infinite;"></i>
        <h3 style="margin: 25px 0 12px; font-size: 1.8rem;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (.CSV)</h3>
        <p style="color:var(--text-muted); margin-bottom:35px; line-height: 1.6;">
          ‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br>
          <small style="color:var(--warning); font-size: 0.9rem;">
            <i class="ri-information-line"></i> ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏ö‡πà‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          </small>
        </p>
        <div style="max-width: 450px; margin: 0 auto;">
          <input type="file" id="csvFileInput" accept=".csv" style="margin-bottom:25px; width:100%;">
          <button class="btn-primary" onclick="importCSV()"
            style="width:100%; justify-content:center; padding:14px; font-size: 1.1rem;">
            <i class="ri-upload-cloud-fill"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå
          </button>
        </div>
      </div>
    </section>

  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, writeBatch, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDVPuFr9DQKlpG8eeX5Jvr8TmcEH_7i7uM",
      authDomain: "bathroom-check-system.firebaseapp.com",
      projectId: "bathroom-check-system",
      storageBucket: "bathroom-check-system.firebasestorage.app",
      messagingSenderId: "738596491428",
      appId: "1:738596491428:web:756904f5c62ee5fe081631"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let allStudents = [];
    let currentAbsentList = [];
    let currentLoggedIds = [];
    let unsubscribeStats = null;
    let readsToday = 43250;
    let readsPeak = 48750;

    window.goToMainMenu = function () {
      window.location.href = 'https://bathroom-check-system.web.app/all.html';
    }

    window.toggleSidebar = () => {
      document.querySelector('.sidebar').classList.toggle('show');
      const sidebar = document.querySelector('.sidebar');
      const backButton = document.getElementById('loggedInBackButton');
      if (sidebar.classList.contains('show')) {
        backButton.style.left = '300px';
      } else {
        backButton.style.left = '80px';
      }
    };

    window.switchTab = (id, el) => {
      document.querySelectorAll('.page-section, .nav-item').forEach(x => x.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      el.classList.add('active');
      if (window.innerWidth <= 900) document.querySelector('.sidebar').classList.remove('show');
    };

    window.showLoading = (show) => document.getElementById("loadingOverlay").style.display = show ? "flex" : "none";

    window.generateSummary = function () {
      const date = document.getElementById('reportDate').value;
      if (!date) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
          text: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö'
        });
        return;
      }

      const content = document.getElementById('summaryContent');

      document.getElementById('roomStatsGrid').innerHTML = `
        <div class="loading-spinner" style="grid-column: 1/-1;">
          <i class="ri-loader-4-line"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
        </div>
      `;
      document.getElementById('summaryList').innerHTML = '';
      document.getElementById('absentDetailList').innerHTML = '';

      content.classList.add('show');

      readsToday += 1;
      updateReads();

      if (readsToday > readsPeak) {
        readsPeak = readsToday;
      }

      loadStats();
    };

    function updateReads() {
      document.getElementById('readsToday').textContent = readsToday.toLocaleString();
      document.getElementById('readsPeak').textContent = readsPeak.toLocaleString();

      const warning = document.getElementById('readWarning');
      if (readsToday >= 45000) {
        warning.style.display = 'block';
        if (readsToday >= 50000) {
          warning.innerHTML = '<i class="ri-alert-line"></i> ‡∏ñ‡∏∂‡∏á 50,000 reads ‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö';
        }
      } else {
        warning.style.display = 'none';
      }
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById("loginPanel").style.display = "none";
        document.getElementById("loggedInBackButton").style.display = "flex";
        document.getElementById("loginBackButton").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô
        document.getElementById("displayName").innerText = user.email === "hdr1234@gmail.com" ? "‡∏Ñ‡∏£‡∏π ‡∏õ‡∏£‡∏∞‡∏Å‡∏¥‡∏ï‡∏ï‡πå ‡∏î‡∏∏‡∏©‡∏é‡∏µ‡∏ò‡∏µ‡∏£‡∏ß‡∏á‡∏®‡πå" : "‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö";
        updateReads();

        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        document.getElementById('reportDate').value = `${year}-${month}-${day}`;

        initData();
      } else {
        document.getElementById("loginPanel").style.display = "flex";
        document.getElementById("loggedInBackButton").style.display = "none";
        document.getElementById("loginBackButton").style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô
      }
    });

    window.handleLogin = async () => {
      try {
        await signInWithEmailAndPassword(auth, document.getElementById("email").value, document.getElementById("password").value);
        Swal.fire({ icon: 'success', title: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö', timer: 1500, showConfirmButton: false });
      } catch (e) {
        Swal.fire({ icon: 'error', title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' });
      }
    };

    window.handleLogout = () => signOut(auth);

    function initData() {
      onSnapshot(collection(db, "students"), (snap) => {
        allStudents = [];
        snap.forEach(doc => allStudents.push({ id: doc.id, ...doc.data() }));
        console.log('‡πÇ‡∏´‡∏•‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß:', allStudents.length, '‡∏Ñ‡∏ô');
      });
    }

    window.startEdit = (id, name, cls) => {
      document.getElementById("editForm").style.display = "block";
      document.getElementById("editOldId").value = id;
      document.getElementById("editId").value = id;
      document.getElementById("editName").value = name;
      document.getElementById("editClass").value = cls;

      if (!id) document.querySelector('#editForm h3').innerHTML = '<i class="ri-user-add-line"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà';
      else document.querySelector('#editForm h3').innerHTML = '<i class="ri-edit-box-line"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';

      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.cancelEdit = () => {
      document.getElementById("editForm").style.display = "none";
    };

    window.updateStudent = async () => {
      const oldId = document.getElementById("editOldId").value;
      const newId = document.getElementById("editId").value;
      const name = document.getElementById("editName").value;
      const cls = document.getElementById("editClass").value;

      if (!newId || !name) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'warning');

      showLoading(true);
      try {
        if (oldId && oldId !== newId) await deleteDoc(doc(db, "students", oldId));
        await setDoc(doc(db, "students", newId), { name, class: cls });
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        cancelEdit();
      } catch (e) {
        Swal.fire('Error', e.message, 'error');
      }
      showLoading(false);
    };

    window.deleteStudent = async (id) => {
      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
        text: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏´‡∏±‡∏™ ${id} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        confirmButtonColor: '#fb7185'
      }).then(async (result) => {
        if (result.isConfirmed) {
          await deleteDoc(doc(db, "students", id));
          Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }
      });
    };

    window.markPresent = async (sid) => {
      const date = document.getElementById("reportDate").value;
      const student = allStudents.find(s => s.id == sid);

      Swal.fire({
        title: `‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ ${student ? student.name : sid}`,
        text: `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date}?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then(async (result) => {
        if (result.isConfirmed) {
          await setDoc(doc(db, "attendanceLogs", `${sid}_${date}`), {
            studentId: sid, date: date, timestamp: serverTimestamp(), manual: true
          });
          const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 3000 });
          Toast.fire({ icon: 'success', title: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' });
          readsToday += 1;
          updateReads();
        }
      });
    };

    window.unmark = async (sid) => {
      const date = document.getElementById("reportDate").value;
      const student = allStudents.find(s => s.id == sid);

      Swal.fire({
        title: `‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠?`,
        text: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á ${student ? student.name : sid} ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô "‡∏Ç‡∏≤‡∏î" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö',
        cancelButtonText: '‡πÑ‡∏°‡πà‡∏•‡∏ö',
        confirmButtonColor: '#fb7185'
      }).then(async (result) => {
        if (result.isConfirmed) {
          await deleteDoc(doc(db, "attendanceLogs", `${sid}_${date}`));
        }
      });
    };

    window.loadStats = () => {
      const date = document.getElementById("reportDate").value;
      if (!date) return;

      if (unsubscribeStats) unsubscribeStats();

      const q = query(collection(db, "attendanceLogs"), where("date", "==", date));
      unsubscribeStats = onSnapshot(q, (snap) => {
        currentLoggedIds = snap.docs.map(d => d.data().studentId);
        renderDashboard(currentLoggedIds);
        renderStudentTable();
      });
    };

    function renderDashboard(loggedIds) {
      const summary = document.getElementById("summaryList");
      const absentTable = document.getElementById("absentDetailList");
      const grid = document.getElementById("roomStatsGrid");

      summary.innerHTML = "";
      absentTable.innerHTML = "";
      grid.innerHTML = "";
      currentAbsentList = [];

      if (allStudents.length === 0) {
        grid.innerHTML = `<div class="loading-spinner" style="grid-column: 1/-1;">
          <i class="ri-loader-4-line"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...
        </div>`;
        return;
      }

      ["6/1", "6/2", "6/3", "6/4", "6/5", "6/6", "6/7"].forEach(cls => {
        const inRoom = allStudents.filter(s => s.class === cls);
        const present = inRoom.filter(s => loggedIds.includes(s.id));
        const absent = inRoom.filter(s => !loggedIds.includes(s.id));

        grid.innerHTML += `<div class="room-card">
          <h4>ROOM ${cls}</h4>
          <div class="val">${present.length}/${inRoom.length}</div>
          <span class="absent-text">‡∏Ç‡∏≤‡∏î ${absent.length} ‡∏Ñ‡∏ô</span>
        </div>`;

        summary.innerHTML += `<tr>
          <td style="font-weight:600; color:var(--primary)">‡∏°.${cls}</td>
          <td>${inRoom.length}</td>
          <td style="color:var(--success); font-weight:600;">${present.length}</td>
          <td><span class="${absent.length > 0 ? 'badge-absent' : 'badge-present'}">${absent.length > 0 ? absent.length + ' ‡∏Ñ‡∏ô' : '‡∏°‡∏≤‡∏Ñ‡∏£‡∏ö'}</span></td>
        </tr>`;

        absent.forEach(std => {
          currentAbsentList.push(std);
          absentTable.innerHTML += `<tr>
            <td style="font-weight:600;">${std.id}</td>
            <td>${std.name}</td>
            <td>‡∏°.${std.class}</td>
            <td style="display:flex; gap:10px;">
              <span class="badge-absent">üî¥ ‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
              <button onclick="markPresent('${std.id}')" class="btn-success" style="padding:6px 12px; font-size:0.85rem;">
                <i class="ri-check-line"></i> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
              </button>
            </td>
          </tr>`;
        });
      });

      if (absentTable.innerHTML === "") {
        absentTable.innerHTML = `<tr><td colspan="4" style="text-align:center; padding:40px; color:var(--success);">
          <i class="ri-checkbox-circle-line" style="font-size:3rem; display:block; margin-bottom:15px;"></i>
          <strong style="font-size:1.2rem;">‡∏°‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÅ‡∏•‡πâ‡∏ß!</strong>
        </td></tr>`;
      }
    }

    window.renderStudentTable = () => {
      const search = document.getElementById("searchBox").value.toLowerCase();
      const cls = document.getElementById("filterClass").value;
      const tbody = document.getElementById("studentTable");
      tbody.innerHTML = "";

      allStudents.filter(s => (cls === 'all' || s.class === cls) && (s.name.toLowerCase().includes(search) || s.id.includes(search)))
        .sort((a, b) => a.id - b.id).forEach(s => {
          const isPresent = currentLoggedIds.includes(s.id);
          const statusBtn = isPresent
            ? `<button class="btn-danger-light btn-icon-round" onclick="unmark('${s.id}')" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠"><i class="ri-close-line"></i></button>`
            : `<button class="btn-primary btn-icon-round" style="background:var(--success)" onclick="markPresent('${s.id}')" title="‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠"><i class="ri-check-double-line"></i></button>`;

          tbody.innerHTML += `<tr>
            <td style="font-weight:600;">${s.id}</td>
            <td>${s.name}</td>
            <td><span class="badge-present" style="background:rgba(167,139,250,0.15); color:var(--primary); border: 1px solid rgba(167,139,250,0.3);">‡∏°.${s.class}</span></td>
            <td style="display:flex; gap:8px;">
              <button class="btn-warning btn-icon-round" onclick="startEdit('${s.id}','${s.name}','${s.class}')"><i class="ri-edit-line"></i></button>
              ${statusBtn}
              <button class="btn-danger-light btn-icon-round" onclick="deleteStudent('${s.id}')"><i class="ri-delete-bin-line"></i></button>
            </td>
          </tr>`;
        });
    };

    window.exportAbsentList = () => {
      if (currentAbsentList.length === 0) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 'info');
      let csv = "\uFEFF‡∏£‡∏´‡∏±‡∏™,‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•,‡∏´‡πâ‡∏≠‡∏á\n" + currentAbsentList.map(s => `${s.id},${s.name},${s.class}`).join("\n");
      const link = document.createElement("a");
      link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
      link.download = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏î_${document.getElementById("reportDate").value}.csv`;
      link.click();

      readsToday += 1;
      updateReads();
    };

    window.importCSV = () => {
      const fileInput = document.getElementById('csvFileInput');
      if (!fileInput.files[0]) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô', 'warning');

      showLoading(true);
      Papa.parse(fileInput.files[0], {
        complete: async (res) => {
          const data = res.data;
          const CHUNK_SIZE = 450;
          let count = 0;

          try {
            for (let i = 0; i < data.length; i += CHUNK_SIZE) {
              const batch = writeBatch(db);
              const chunk = data.slice(i, i + CHUNK_SIZE);
              chunk.forEach(row => {
                if (row[0] && row[1]) {
                  batch.set(doc(db, "students", row[0].toString().trim()), {
                    name: row[1].trim(),
                    class: (row[2] || "6/1").trim()
                  });
                  count++;
                }
              });
              await batch.commit();
            }
            showLoading(false);
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'success');

            readsToday += 1;
            updateReads();
          } catch (e) {
            showLoading(false);
            Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', e.message, 'error');
          }
        }
      });
    };

    document.getElementById('summaryContent').classList.remove('show');
  </script>
</body>

</html>